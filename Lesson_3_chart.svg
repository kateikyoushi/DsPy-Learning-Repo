<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="ACTIVITY" height="1083px" preserveAspectRatio="none" style="width:621px;height:1083px;background:#FFFFFF;" version="1.1" viewBox="0 0 621 1083" width="621px" zoomAndPan="magnify"><title>DSPy Optimization Pipeline: Wikipedia RAG Agent + MIPROv2</title><defs/><g><rect fill="#FFFFCC" height="26.6406" rx="2.5" ry="2.5" style="stroke:#FFDD88;stroke-width:3;" width="610.0259" x="5" y="5"/><text fill="#000000" font-family="monospace" font-size="10" lengthAdjust="spacing" textLength="355.21" x="10" y="20">Please&#160;use&#160;'!option&#160;handwritten&#160;true'&#160;to&#160;enable&#160;handwritten</text><g class="title" data-source-line="10"><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="486.8486" x="58.0886" y="69.6357">DSPy Optimization Pipeline: Wikipedia RAG Agent + MIPROv2</text></g><rect fill="none" height="261.75" style="stroke:#000000;stroke-width:1.5;" width="460.999" x="25.4209" y="84.9375"/><path d="M204.8291,84.9375 L204.8291,94.2344 L194.8291,104.2344 L25.4209,104.2344" fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="169.4082" x="28.4209" y="98.9326">1. System Configuration</text><path d="M239.8613,114.2344 L239.8613,137.9336 L219.8613,141.9336 L239.8613,145.9336 L239.8613,169.6328 A0,0 0 0 0 239.8613,169.6328 L474.7012,169.6328 A0,0 0 0 0 474.7012,169.6328 L474.7012,124.2344 L464.7012,114.2344 L239.8613,114.2344 A0,0 0 0 0 239.8613,114.2344" fill="#FFF9C4" style="stroke:#FBC02D;stroke-width:0.5;"/><path d="M464.7012,114.2344 L464.7012,124.2344 L474.7012,124.2344 L464.7012,114.2344" fill="#FFF9C4" style="stroke:#FBC02D;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="213.8398" x="245.8613" y="131.3013">Model: groq/llama-3.1-8b-instant</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="210.4883" x="245.8613" y="146.4341">Max Tokens: 512 (Conservative)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="66.041" x="245.8613" y="161.5669">Temp: 0.7</text><rect fill="#F0F4F8" height="33.9688" rx="12.5" ry="12.5" style="stroke:#2C3E50;stroke-width:0.5;" width="130.9707" x="88.8906" y="124.9492"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="110.9707" x="98.8906" y="146.0879">Load Groq API Key</text><path d="M264.1396,186.4844 L264.1396,202.6172 L244.1396,206.6172 L264.1396,210.6172 L264.1396,226.75 A0,0 0 0 0 264.1396,226.75 L476.4199,226.75 A0,0 0 0 0 476.4199,226.75 L476.4199,196.4844 L466.4199,186.4844 L264.1396,186.4844 A0,0 0 0 0 264.1396,186.4844" fill="#FFF9C4" style="stroke:#FBC02D;stroke-width:0.5;"/><path d="M466.4199,186.4844 L466.4199,196.4844 L476.4199,196.4844 L466.4199,186.4844" fill="#FFF9C4" style="stroke:#FBC02D;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191.2803" x="270.1396" y="203.5513">Experiment: "dspy_course_4"</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="187.6431" x="270.1396" y="218.6841">Logs: evals, compiles, traces</text><rect fill="#F0F4F8" height="33.9688" rx="12.5" ry="12.5" style="stroke:#2C3E50;stroke-width:0.5;" width="179.5273" x="64.6123" y="189.6328"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="159.5273" x="74.6123" y="210.7715">Configure MLflow Tracking</text><rect fill="#F0F4F8" height="33.9688" rx="12.5" ry="12.5" style="stroke:#2C3E50;stroke-width:0.5;" width="105.2305" x="101.7607" y="246.75"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="85.2305" x="111.7607" y="267.8887">Initialize DSPy</text><rect fill="#F0F4F8" height="33.9688" rx="12.5" ry="12.5" style="stroke:#2C3E50;stroke-width:0.5;" width="237.9102" x="35.4209" y="300.7188"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="217.9102" x="45.4209" y="321.8574">Install Visualization Libs (matplotlib)</text><rect fill="none" height="153.8125" style="stroke:#000000;stroke-width:1.5;" width="478.6377" x="44.2354" y="356.6875"/><path d="M220.3281,356.6875 L220.3281,365.9844 L210.3281,375.9844 L44.2354,375.9844" fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="166.0928" x="47.2354" y="370.6826">2. RAG Agent Definition</text><path d="M274.5166,385.9844 L274.5166,409.6836 L254.5166,413.6836 L274.5166,417.6836 L274.5166,441.3828 A0,0 0 0 0 274.5166,441.3828 L512.873,441.3828 A0,0 0 0 0 512.873,441.3828 L512.873,395.9844 L502.873,385.9844 L274.5166,385.9844 A0,0 0 0 0 274.5166,385.9844" fill="#FFF9C4" style="stroke:#FBC02D;stroke-width:0.5;"/><path d="M502.873,385.9844 L502.873,395.9844 L512.873,395.9844 L502.873,385.9844" fill="#FFF9C4" style="stroke:#FBC02D;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="177.582" x="280.5166" y="403.0513">Optimized with @lru_cache</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="217.3564" x="280.5166" y="418.1841">Rate Limit Protection (0.5s sleep)</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="200.7764" x="280.5166" y="433.3169">Truncates chunks to 500 chars</text><rect fill="#F0F4F8" height="33.9688" rx="12.5" ry="12.5" style="stroke:#2C3E50;stroke-width:0.5;" width="200.2813" x="54.2354" y="396.6992"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="180.2813" x="64.2354" y="417.8379">Define Tool: Wikipedia Search</text><path d="M268.8975,458.2344 L268.8975,474.3672 L248.8975,478.3672 L268.8975,482.3672 L268.8975,498.5 A0,0 0 0 0 268.8975,498.5 L461.0811,498.5 A0,0 0 0 0 461.0811,498.5 L461.0811,468.2344 L451.0811,458.2344 L268.8975,458.2344 A0,0 0 0 0 268.8975,458.2344" fill="#FFF9C4" style="stroke:#FBC02D;stroke-width:0.5;"/><path d="M451.0811,458.2344 L451.0811,468.2344 L461.0811,468.2344 L451.0811,458.2344" fill="#FFF9C4" style="stroke:#FBC02D;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171.1836" x="274.8975" y="475.3013">Logic: Reasoning + Acting</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="170.3774" x="274.8975" y="490.4341">Can search multiple times</text><rect fill="#F0F4F8" height="33.9688" rx="12.5" ry="12.5" style="stroke:#2C3E50;stroke-width:0.5;" width="189.043" x="59.8545" y="461.3828"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="169.043" x="69.8545" y="482.5215">Define Agent: ReAct Module</text><rect fill="none" height="352.0313" style="stroke:#000000;stroke-width:1.5;" width="584.0259" x="11" y="520.5"/><path d="M244.5967,520.5 L244.5967,529.7969 L234.5967,539.7969 L11,539.7969" fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="223.5967" x="14" y="534.4951">3. Optimization Loop (MIPROv2)</text><rect fill="#F0F4F8" height="33.9688" rx="12.5" ry="12.5" style="stroke:#2C3E50;stroke-width:0.5;" width="169.332" x="69.71" y="556.7969"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="149.332" x="79.71" y="577.9355">Start MIPROv2 Optimizer</text><rect fill="none" height="202.6484" style="stroke:#000000;stroke-width:1.5;" width="564.0259" x="21" y="600.7656"/><path d="M381.7861,600.7656 L381.7861,610.0625 L371.7861,620.0625 L21,620.0625" fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="350.7861" x="24" y="614.7607">Optimization Process (Bootstrapping &amp; Proposing)</text><path d="M297.752,636.9141 L297.752,653.0469 L277.752,657.0469 L297.752,661.0469 L297.752,677.1797 A0,0 0 0 0 297.752,677.1797 L575.0259,677.1797 A0,0 0 0 0 575.0259,677.1797 L575.0259,646.9141 L565.0259,636.9141 L297.752,636.9141 A0,0 0 0 0 297.752,636.9141" fill="#FFF9C4" style="stroke:#FBC02D;stroke-width:0.5;"/><path d="M565.0259,636.9141 L565.0259,646.9141 L575.0259,646.9141 L565.0259,636.9141" fill="#FFF9C4" style="stroke:#FBC02D;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="256.2739" x="303.752" y="653.981">Finds best examples from training data</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207.835" x="303.752" y="669.1138">(N=3 sets bootstrapped in logs)</text><rect fill="#F0F4F8" height="33.9688" rx="12.5" ry="12.5" style="stroke:#2C3E50;stroke-width:0.5;" width="246.752" x="31" y="640.0625"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="226.752" x="41" y="661.2012">Step 1: Bootstrap Few-Shot Examples</text><path d="M268.8887,694.0313 L268.8887,710.1641 L248.8887,714.1641 L268.8887,718.1641 L268.8887,734.2969 A0,0 0 0 0 268.8887,734.2969 L520.334,734.2969 A0,0 0 0 0 520.334,734.2969 L520.334,704.0313 L510.334,694.0313 L268.8887,694.0313 A0,0 0 0 0 268.8887,694.0313" fill="#FFF9C4" style="stroke:#FBC02D;stroke-width:0.5;"/><path d="M510.334,694.0313 L510.334,704.0313 L520.334,704.0313 L510.334,694.0313" fill="#FFF9C4" style="stroke:#FBC02D;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230.4453" x="274.8887" y="711.0981">Generates new prompt instructions</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218.9307" x="274.8887" y="726.231">(e.g., "Be creative", "Be concise")</text><rect fill="#F0F4F8" height="33.9688" rx="12.5" ry="12.5" style="stroke:#2C3E50;stroke-width:0.5;" width="189.0254" x="59.8633" y="697.1797"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="169.0254" x="69.8633" y="718.3184">Step 2: Propose Instructions</text><path d="M269.6064,751.1484 L269.6064,767.2813 L249.6064,771.2813 L269.6064,775.2813 L269.6064,791.4141 A0,0 0 0 0 269.6064,791.4141 L471.8066,791.4141 A0,0 0 0 0 471.8066,791.4141 L471.8066,761.1484 L461.8066,751.1484 L269.6064,751.1484 A0,0 0 0 0 269.6064,751.1484" fill="#FFF9C4" style="stroke:#FBC02D;stroke-width:0.5;"/><path d="M461.8066,751.1484 L461.8066,761.1484 L471.8066,761.1484 L461.8066,751.1484" fill="#FFF9C4" style="stroke:#FBC02D;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="138.7661" x="275.6064" y="768.2153">Runs agent on Valset</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181.2002" x="275.6064" y="783.3481">Scores using Custom Metric</text><rect fill="#F0F4F8" height="33.9688" rx="12.5" ry="12.5" style="stroke:#2C3E50;stroke-width:0.5;" width="190.4609" x="59.1455" y="754.2969"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="170.4609" x="69.1455" y="775.4355">Step 3: Evaluate Candidates</text><path d="M245.5391,820.2656 L245.5391,836.3984 L225.5391,840.3984 L245.5391,844.3984 L245.5391,860.5313 A0,0 0 0 0 245.5391,860.5313 L458.9937,860.5313 A0,0 0 0 0 458.9937,860.5313 L458.9937,830.2656 L448.9937,820.2656 L245.5391,820.2656 A0,0 0 0 0 245.5391,820.2656" fill="#FFF9C4" style="stroke:#FBC02D;stroke-width:0.5;"/><path d="M448.9937,820.2656 L448.9937,830.2656 L458.9937,830.2656 L448.9937,820.2656" fill="#FFF9C4" style="stroke:#FBC02D;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="192.4546" x="251.5391" y="837.3325">The prompt combination with</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="181.1621" x="251.5391" y="852.4653">the highest validation score</text><rect fill="#F0F4F8" height="33.9688" rx="12.5" ry="12.5" style="stroke:#2C3E50;stroke-width:0.5;" width="142.3262" x="83.2129" y="823.4141"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="122.3262" x="93.2129" y="844.5527">Select Best Program</text><rect fill="none" height="190.2031" style="stroke:#000000;stroke-width:1.5;" width="193.6504" x="57.5508" y="882.5313"/><path d="M233.5547,882.5313 L233.5547,891.8281 L223.5547,901.8281 L57.5508,901.8281" fill="none" style="stroke:#000000;stroke-width:1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="166.0039" x="60.5508" y="896.5264">4. Output &amp; Verification</text><rect fill="#F0F4F8" height="33.9688" rx="12.5" ry="12.5" style="stroke:#2C3E50;stroke-width:0.5;" width="173.6504" x="67.5508" y="918.8281"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="153.6504" x="77.5508" y="939.9668">Compile Optimized Agent</text><rect fill="#F0F4F8" height="33.9688" rx="12.5" ry="12.5" style="stroke:#2C3E50;stroke-width:0.5;" width="150.7578" x="78.9971" y="972.7969"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="130.7578" x="88.9971" y="993.9355">Log Results to MLflow</text><rect fill="#F0F4F8" height="33.9688" rx="12.5" ry="12.5" style="stroke:#2C3E50;stroke-width:0.5;" width="138.5762" x="85.0879" y="1026.7656"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="118.5762" x="95.0879" y="1047.9043">Ready for Inference</text><line style="stroke:#333333;stroke-width:1;" x1="154.376" x2="154.376" y1="158.918" y2="189.6328"/><polygon fill="#333333" points="150.376,179.6328,154.376,189.6328,158.376,179.6328,154.376,183.6328" style="stroke:#333333;stroke-width:1;"/><line style="stroke:#333333;stroke-width:1;" x1="154.376" x2="154.376" y1="223.6016" y2="246.75"/><polygon fill="#333333" points="150.376,236.75,154.376,246.75,158.376,236.75,154.376,240.75" style="stroke:#333333;stroke-width:1;"/><line style="stroke:#333333;stroke-width:1;" x1="154.376" x2="154.376" y1="280.7188" y2="300.7188"/><polygon fill="#333333" points="150.376,290.7188,154.376,300.7188,158.376,290.7188,154.376,294.7188" style="stroke:#333333;stroke-width:1;"/><line style="stroke:#333333;stroke-width:1;" x1="154.376" x2="154.376" y1="430.668" y2="461.3828"/><polygon fill="#333333" points="150.376,451.3828,154.376,461.3828,158.376,451.3828,154.376,455.3828" style="stroke:#333333;stroke-width:1;"/><line style="stroke:#333333;stroke-width:1;" x1="154.376" x2="154.376" y1="334.6875" y2="396.6992"/><polygon fill="#333333" points="150.376,386.6992,154.376,396.6992,158.376,386.6992,154.376,390.6992" style="stroke:#333333;stroke-width:1;"/><line style="stroke:#333333;stroke-width:1;" x1="154.376" x2="154.376" y1="674.0313" y2="697.1797"/><polygon fill="#333333" points="150.376,687.1797,154.376,697.1797,158.376,687.1797,154.376,691.1797" style="stroke:#333333;stroke-width:1;"/><line style="stroke:#333333;stroke-width:1;" x1="154.376" x2="154.376" y1="731.1484" y2="754.2969"/><polygon fill="#333333" points="150.376,744.2969,154.376,754.2969,158.376,744.2969,154.376,748.2969" style="stroke:#333333;stroke-width:1;"/><line style="stroke:#333333;stroke-width:1;" x1="154.376" x2="154.376" y1="590.7656" y2="640.0625"/><polygon fill="#333333" points="150.376,630.0625,154.376,640.0625,158.376,630.0625,154.376,634.0625" style="stroke:#333333;stroke-width:1;"/><line style="stroke:#333333;stroke-width:1;" x1="154.376" x2="154.376" y1="788.2656" y2="823.4141"/><polygon fill="#333333" points="150.376,813.4141,154.376,823.4141,158.376,813.4141,154.376,817.4141" style="stroke:#333333;stroke-width:1;"/><line style="stroke:#333333;stroke-width:1;" x1="154.376" x2="154.376" y1="495.3516" y2="556.7969"/><polygon fill="#333333" points="150.376,546.7969,154.376,556.7969,158.376,546.7969,154.376,550.7969" style="stroke:#333333;stroke-width:1;"/><line style="stroke:#333333;stroke-width:1;" x1="154.376" x2="154.376" y1="952.7969" y2="972.7969"/><polygon fill="#333333" points="150.376,962.7969,154.376,972.7969,158.376,962.7969,154.376,966.7969" style="stroke:#333333;stroke-width:1;"/><line style="stroke:#333333;stroke-width:1;" x1="154.376" x2="154.376" y1="1006.7656" y2="1026.7656"/><polygon fill="#333333" points="150.376,1016.7656,154.376,1026.7656,158.376,1016.7656,154.376,1020.7656" style="stroke:#333333;stroke-width:1;"/><line style="stroke:#333333;stroke-width:1;" x1="154.376" x2="154.376" y1="857.3828" y2="918.8281"/><polygon fill="#333333" points="150.376,908.8281,154.376,918.8281,158.376,908.8281,154.376,912.8281" style="stroke:#333333;stroke-width:1;"/><!--SRC=[VLLXR-8u4FtEhnYnqebgjno5LhiNTD8LMgfgwIw2glUnCicGZ73ihEt0igV-znix0QMKBk93d1cFtxptnh5hKeKm8eUbYDUfqQLAnbfg0zkC7BRi8Pu9bMmDEOSALaBQPinc8j5RKkcRoBKnUbiL_308lsOmThGXjniT7VrXqfjSJhwSojGcGLDdzSU3swjU8-kRTlYsrcJor_ZoEAjPPp8Qz_ethPOZ9n5k5hCTV2ySvVHBED8APbIW98KH_4jhVav8mFpw3gvJL0u-miFzRFvzqs-rk3xNy5lQ5rrOxAp37CPQhIWjJQZLXlzQ0D5KYmJkZFu1rxDx-8gx8RzLZ0iCfPdZ1S23Jb16mBty-5DAaOlpGVVY_Clod9HrGjL9uYSywZKg6y7LHHywV9f5i-73DdWMKXunBoBeTJ_p2bKIZcbv47jW20_JbTHRU3JC7Oju0ipjpm8DvTnl1Et45hldM9V6ulDbEyIdEcK4k67rFq6iyu8ayfFZYcYF3xvNJ9AGzAiYUrYzuwQaX2UofGzLp4zfQQ6J2rT8xIGjpuQjbrSqzxiD9MvmHOeQD8SNo0HfsTHkWSB4sOakQzKnWIsv3FwHfdoEHPnXYCu59qyvmS7CyCOuGEZqkbSMh4GiQhvDgM9EjH1dfLfRS1gkUZrU2VE6YXfXm1_17DddNlXIuWbuJ3B5FajOhVomVGnpeT8G7Gi5DdG6UIaT5UnbRkSr_Q_P6tHV6tsgTG6TsivdDOaBnnls7ZzGP3m-_ljHAw3zUbwCPjLPk97Mph87YiAZ_SC72ctvkQuTgcC15n4SKc62s_D5fXrxJkJSX1s6p2Ck02Qa4WjBj0wmpeILqRat7GLw4k54dTpvzlU0sN6yuO29PIO5afrR2NSWoIyQwFfH3Hp1kzIKGVZtODsXGXFaLxY5WW4L3gYnRuy8ksdt4xH72B71CA_jUgbLJ1RRlqSrYE2MnwtqfcJf4qhyeU-0cfVAWWX3mley-Jjw7rh4sZ3Oqii2uz8wPl01dQ7u-FYNIl5eWPAz3oFFF1EJyfrwmgoF6Uwxv_jWIQhoXX-i47SSppZRL-4-F7mVjnxE-uwzPCUMhYWTk-c9RwGLnSrxTLpTF8r13fCrhExSb4V7ycY4aQpkl13XWKfsiE9FmRrQeK4Ly_Iz_0y0]--></g></svg>